<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng Nhập / Đăng Ký</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            background-color: #f8f9fa; /* Light gray background */
        }
        .toast-contaianer{
            z-index: 9999;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Soft shadow for card */
        }
        .card-header {
            background-color: #fff; /* White card header */
            border-bottom: 1px solid #dee2e6;
             padding: 20px;
            border-top-left-radius: 15px;
             border-top-right-radius: 15px;
        }
        .nav-tabs .nav-link {
            color: #495057;
            border: none;
            border-bottom: 2px solid transparent;
            transition: border-bottom-color 0.3s;
              font-size: 1.1rem;
        }
        .nav-tabs .nav-link.active {
            color: #0d6efd; /* Blue color when active */
            border-bottom-color: #0d6efd;
        }
        .card-body {
            padding: 20px;
        }
         .form-label {
            font-weight: 500;
             font-size: 1rem;
         }
           .form-control, .form-select {
               font-size: 1rem;
           }
         .btn-primary, .btn-success{
             border-radius: 8px;
         }
         .btn-primary {
             background-color: #0d6efd;
             border-color: #0d6efd;
         }
         .btn-primary:hover{
            background-color: #0b5ed7;
             border-color: #0a58ca;
         }
        .btn-success {
             background-color: #198754;
             border-color: #198754;
         }
            .btn-success:hover {
            background-color: #157347;
              border-color: #146c43;
         }
        .popup {
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 20px;
          border: 1px solid #ccc;
          box-shadow: 0 0 10px rgba(0,0,0,0.2);
          z-index: 1000;
          display: none;
             max-height: 90vh;
             overflow-y: auto;
              border-radius: 10px;
        }
         .popup.active{
            display: block;
        }
         .popup-content{
             padding: 15px;
         }
        #profile-popup .popup-content p {
            margin-bottom: 10px;
        }
        #profile-popup h3{
            margin-bottom: 20px;
            text-align: center;
            color: #343a40;
        }
        .btn-close{
            margin-top: -10px;
            margin-right: -10px;
            float: right;
        }
          .btn-danger{
              border-radius: 8px;
          }
    </style>
</head>
<body>
     <div id="toast-container" class="position-fixed top-0 end-0 p-3" style="z-index: 11"></div>
    <div class="container mt-5">
       
        <div class="row justify-content-center">
            <div class="col-md-6">
                 <div class="card">
                     <div class="card-header text-center">
                        <ul class="nav nav-tabs card-header-tabs">
                            <li class="nav-item">
                                <a class="nav-link active" id="login-tab" data-bs-toggle="tab" href="#login">Đăng Nhập</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="register-tab" data-bs-toggle="tab" href="#register">Đăng Ký</a>
                            </li>
                        </ul>
                    </div>
                    <div class="card-body">
                         <div class="tab-content">
                             <div class="tab-pane fade show active" id="login">
                                <form id="login-form">
                                    <div class="mb-3">
                                        <label for="login-username" class="form-label">Tên đăng nhập</label>
                                        <input type="text" class="form-control" id="login-username" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="login-password" class="form-label">Mật khẩu</label>
                                        <input type="password" class="form-control" id="login-password" required>
                                    </div>
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-primary">Đăng Nhập</button>
                                    </div>
                                </form>
                            </div>

                            <div class="tab-pane fade" id="register">
                                <form id="register-form">
                                    <div class="mb-3">
                                        <label for="register-fullname" class="form-label">Họ và tên</label>
                                        <input type="text" class="form-control" id="register-fullname" required>
                                    </div>
                                     <div class="mb-3">
                                         <label for="register-username" class="form-label">Tên đăng nhập</label>
                                         <input type="text" class="form-control" id="register-username" required>
                                     </div>
                                    <div class="mb-3">
                                        <label for="register-password" class="form-label">Mật khẩu</label>
                                        <input type="password" class="form-control" id="register-password" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="register-confirm-password" class="form-label">Nhập lại mật khẩu</label>
                                        <input type="password" class="form-control" id="register-confirm-password" required>
                                    </div>
                                     <div class="mb-3">
                                        <label for="register-email" class="form-label">Email</label>
                                        <input type="email" class="form-control" id="register-email" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="register-phone" class="form-label">Số điện thoại</label>
                                        <input type="tel" class="form-control" id="register-phone" required>
                                    </div>
                                    <div>
                                        <label class="form-label">Địa chỉ</label>
                                        <div>
                                            <select class="form-select form-select-sm mb-3" id="city" aria-label=".form-select-sm">
                                                <option value="" selected>Chọn tỉnh thành</option>           
                                            </select>
                                                    
                                            <select class="form-select form-select-sm mb-3" id="district" aria-label=".form-select-sm">
                                                <option value="" selected>Chọn quận huyện</option>
                                            </select>

                                            <select class="form-select form-select-sm" id="ward" aria-label=".form-select-sm">
                                                <option value="" selected>Chọn phường xã</option>
                                            </select>
                                        </div>    
                                    </div>
                                     <div class="mb-3">
                                        <label for="register-dob" class="form-label">Ngày sinh</label>
                                        <input type="date" class="form-control" id="register-dob" required>
                                    </div>
                                    <div class="d-grid">
                                        <button type="submit" class="btn btn-success">Đăng Ký</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                     </div>
                </div>
            </div>
        </div>
    </div>
      <div id="profile-popup" class="popup">
            <div class="popup-content">
                 <button type="button" class="btn-close" aria-label="Close"></button>
              <h3>Thông tin cá nhân</h3>
                <p><strong>Họ và tên:</strong> <span id="popup-fullname"></span></p>
                <p><strong>Tên đăng nhập:</strong> <span id="popup-username"></span></p>
                <p><strong>Email:</strong> <span id="popup-email"></span></p>
                <p><strong>Số điện thoại:</strong> <span id="popup-phone"></span></p>
                <p><strong>Địa chỉ:</strong> <span id="popup-address"></span></p>
                 <p><strong>Ngày sinh:</strong> <span id="popup-dob"></span></p>
                 <div class="d-flex justify-content-end mt-3">
                    <button class="btn btn-primary me-2" id="change-password-btn">Đổi mật khẩu</button>
                    <button class="btn btn-danger" id="logout-btn">Đăng xuất</button>
                </div>
                 <form id="change-password-form" style="display: none;">
                        <div class="mb-3">
                            <label for="current-password" class="form-label">Mật khẩu hiện tại</label>
                            <input type="password" class="form-control" id="current-password" required>
                        </div>
                         <div class="mb-3">
                            <label for="new-password" class="form-label">Mật khẩu mới</label>
                             <input type="password" class="form-control" id="new-password" required>
                         </div>
                         <div class="mb-3">
                            <label for="confirm-new-password" class="form-label">Nhập lại mật khẩu mới</label>
                             <input type="password" class="form-control" id="confirm-new-password" required>
                         </div>
                         <div class="d-grid">
                             <button type="submit" class="btn btn-primary">Xác nhận đổi mật khẩu</button>
                        </div>
                    </form>
            </div>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
    const toastContainer = document.getElementById('toast-container');
    const profilePopup = document.getElementById('profile-popup');
    const changePasswordForm = document.getElementById('change-password-form');
     const changePasswordBtn = document.getElementById('change-password-btn');
    const logoutBtn = document.getElementById('logout-btn');

    function showToast(message, type) {
        const toast = document.createElement('div');
        toast.classList.add('toast', 'fade', 'show');
        toast.setAttribute('role', 'alert');
        toast.setAttribute('aria-live', 'assertive');
        toast.setAttribute('aria-atomic', 'true');
        toast.style.backgroundColor = type === 'success' ? '#28a745' : '#dc3545';
        toast.style.color = 'white';
        toast.style.marginTop = '10px';

        toast.innerHTML = `
            <div class="d-flex">
               <div class="toast-body">${message}</div>
               <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        `;
         toastContainer.appendChild(toast);
         setTimeout(() => {
            toast.remove();
          }, 5000);
    }

    // Xử lý đăng nhập
    document.getElementById('login-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const loginUsername = document.getElementById('login-username').value;
        const loginPassword = document.getElementById('login-password').value;

         const storedUsers = localStorage.getItem('users');
        if (storedUsers) {
            const users = JSON.parse(storedUsers);
            const user = users.find(user => user.username === loginUsername && user.password === loginPassword);
             if (user) {
                showToast('Đăng nhập thành công!', 'success');
                const currentTime = new Date().getTime();
                 localStorage.setItem('loginTime', currentTime);
                 localStorage.setItem('user', JSON.stringify(user));
                window.location.href = 'trangcanhan.html';
            } else {
                 showToast('Đăng nhập thất bại. Vui lòng kiểm tra lại tên đăng nhập hoặc mật khẩu.', 'error');
            }
        }else{
             showToast('Đăng nhập thất bại. Bạn chưa có tài khoản.', 'error');
        }

    });

      // Xử lý đăng ký
        document.getElementById('register-form').addEventListener('submit', function(event) {
            event.preventDefault();
              const registerFullname = document.getElementById('register-fullname').value;
            const registerUsername = document.getElementById('register-username').value;
            const registerPassword = document.getElementById('register-password').value;
            const registerConfirmPassword = document.getElementById('register-confirm-password').value;
            const registerEmail = document.getElementById('register-email').value;
            const registerPhone = document.getElementById('register-phone').value;
            const city = document.getElementById('city').options[document.getElementById('city').selectedIndex].text;
            const district = document.getElementById('district').options[document.getElementById('district').selectedIndex].text;
            const ward = document.getElementById('ward').options[document.getElementById('ward').selectedIndex].text;
            const registerDob = document.getElementById('register-dob').value;

             const selectedDate = new Date(registerDob);
            const limitDate = new Date('2015-12-31');

             if(selectedDate > limitDate){
                  showToast('Ngày sinh không hợp lệ. Vui lòng thử lại.', 'error');
                 return;
            }
             if(registerPassword !== registerConfirmPassword){
                showToast('Mật khẩu và nhập lại mật khẩu không trùng khớp.', 'error');
                return;
             }
           const newUser = {
                fullname: registerFullname,
                username: registerUsername,
                password: registerPassword,
                email: registerEmail,
                phone: registerPhone,
                city: city,
                district: district,
                ward: ward,
                dob: registerDob,
            };

             let users = JSON.parse(localStorage.getItem('users') || '[]');
             users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));

            showToast('Đăng ký thành công!', 'success');
            var loginTab = new bootstrap.Tab(document.getElementById('login-tab'));
            loginTab.show();
        });


    // Lấy dữ liệu tỉnh thành
    var citis = document.getElementById("city");
    var districts = document.getElementById("district");
    var wards = document.getElementById("ward");
    var Parameter = {
      url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
      method: "GET",
      responseType: "application/json",
    };
    var promise = axios(Parameter);
    promise.then(function (result) {
      renderCity(result.data);
    });

    function renderCity(data) {
      for (const x of data) {
        citis.options[citis.options.length] = new Option(x.Name, x.Id);
      }
      citis.onchange = function () {
        district.length = 1;
        ward.length = 1;
        if(this.value != ""){
          const result = data.filter(n => n.Id === this.value);

          for (const k of result[0].Districts) {
            district.options[district.options.length] = new Option(k.Name, k.Id);
          }
        }
      };
      district.onchange = function () {
        ward.length = 1;
        const dataCity = data.filter((n) => n.Id === citis.value);
        if (this.value != "") {
          const dataWards = dataCity[0].Districts.filter(n => n.Id === this.value)[0].Wards;

          for (const w of dataWards) {
            wards.options[wards.options.length] = new Option(w.Name, w.Id);
          }
        }
      };
    }
    </script>
</body>
</html>